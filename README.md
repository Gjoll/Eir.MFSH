# MFSH

FSH prepropcessor

## Installation

Open Visual Studio Package Manager Console, and type the following.

dotnet tool install --global Eir.MFSH --version 2.0.5

to upgrade,

dotnet tool uninstall --global Eir.MFSH

dotnet tool install --global Eir.MFSH --version 2.0.5

## Command Line Option

MFSH has only one optional command line option. This option is the name of the 
json configuration file that configures the watches.
If no name is passed on the command line, then the config file defaults to

MFSH.json

## Options file

MFSH is controlled from a user defined json file. 

```json
{
	"baseInputDir": "{path}",
	"baseOutputDir": "{path}",
	"baseUrl": "{url}",
	"mfshPaths": [
		"MFSH"
	],
	"defines": [
		{
			"name": "%GraphDir%",
			"value": "..\\GraphFiles"
		}
	],
	"cleanDirs": [
		{
			"path": "..\\build\\input\\pagecontent",
			"filter": "StructureDefinition-*-intro.xml"
		}
	]
}
```

The format of this file is json.
| name | meaning |
| ---- | -------------- |
| {baseInputDir} | Base Input Dir. The output path is computed by taking the input path minus its base dir and adding the output dir |
| {baseOutputDir} | Base dir of all output files |
| {baseUrl} | Fhir base url for all profiles being generated by this project.  |
| {working dir} | Sets the working dir used when a command is executed. |
| {mfshPaths} | Array of input files/directories to process. All *.minc and *.mfsh files referenced here will be processed |
| {defines} | Define variable values. When processing mfsh content, these variables can be referenced |
| {cleanDirs} | Optional array of directories to clean. At startup all files in the path matching the file filter will be scanned. If they are not updated during the running of the program they will be deleted at program conclusion |

## MFSH Grammar

MFSH reads two kinds of files
| name | meaning |
| ---- | -------------- |
| *.minc | These files include macro and variable definitions, but do not generate directly any fsh |
| *.mfsh | These files can include macro and variable definitions like .minc files, but they will generate a corresponding .fsh file |

### MFSH Commands

All mfsh commands are formatted as a line that starts with a '#'. White space can proceed the '#' character.

i.e.

\#macro xxyyz()

mfsh commands can be found in both .minc and .mfsh files.

### FSH Text

Lines that do not start with a '#' are processed as fsh (or json/text if in a macro redirect).
MFSH will replace any variables references in these lines with the variable value.

### Variable Expansion
Variables can be defined which can be referenced in redirect paths, mfsh commands, and fsh text. When a string matching the variable is detected,
the value of the variable will replace the actual variable name.

There are two types of variables.

%{name}%

variables that start and end with '%' will be expanded whereever they are found

{name}

variables that do not start and end with '%' will be expanded only if they are seperate words.

i.e. if a variable xxyyz is defined, then the string

ABCxxyyzDEF

will not have xxyyz relaced,

ABC xxyyz DEF

will have its variable replaced.


